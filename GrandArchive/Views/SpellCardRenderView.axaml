<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:helpers="clr-namespace:GrandArchive.Helpers"
             xmlns:database="clr-namespace:GrandArchive.Models.Database"
             xmlns:mdxaml="https://github.com/whistyun/Markdown.Avalonia"
             xmlns:avalonia="clr-namespace:ColorTextBlock.Avalonia;assembly=ColorTextBlock.Avalonia"
             xmlns:views="clr-namespace:GrandArchive.Views"
             mc:Ignorable="d"
             x:Class="GrandArchive.Views.SpellCardRenderView"
             x:DataType="database:DndSpell">

    <Design.DataContext>
        <database:DndSpell
            Name="Hyper-Employment Spell of Testus Maximus"
            School="Abjuration,Enchantment"
            SubSchool="Compulsion"
            Descriptor="LanguageDependent,MindAffecting"
            HasVerbalComponent="True"
            HasArcaneFocus="True"
            HasCorruptionComponent="True"
            ArcaneFocus="A pen and a handwritten contract"
            CorruptionComponent="10d20 Gold"
            ExtraComponent="Firm Handshake"
            CastingTime="1 hour"
            Range="Custom"
            CustomRangeText="Something between 5 and 200 ft."
            Duration="Unlimited"
            SavingThrow="Will negates (harmless; see text)"
            SpellResistance="No"
            Target="One unwilling creature"
            Area=""
            Effect="Instant willingness"
            RulebookPage="69"
            DescriptionShort="What, are you really gonna read the full description? Do you not trust me? Is our company's reputation not enough for you? We are not a black company, unlike Cover Corp! You are such a heartless person."
            Description="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras eu dolor ut erat bibendum sagittis ac vel nulla. Nulla ultrices vitae neque vitae consectetur. Nullam a odio quis dui iaculis volutpat a id mauris. Nam nec nunc a tellus mollis condimentum. Integer cursus justo mollis metus commodo dapibus. Proin at pellentesque leo, eget cursus velit. Suspendisse potenti. Morbi placerat felis ut tortor pharetra, ut vestibulum eros laoreet. Ut non gravida tellus. Nulla nulla ante, dignissim et fermentum eu, tristique sed metus. Duis cursus nulla vel tortor malesuada auctor. Aliquam lacinia mi vitae vehicula commodo. Curabitur posuere imperdiet tellus, in malesuada metus finibus mattis. Curabitur id maximus neque, id dignissim nunc. Vivamus id maximus augue.&#x0a;&#x0a;Sed dolor massa, elementum eu viverra et, viverra vel lacus. Integer euismod nulla tellus. Integer mattis, nisi vitae gravida sagittis, lacus metus rhoncus dui, vitae scelerisque mauris arcu non magna. Duis vel egestas risus. Aenean malesuada ultrices vestibulum. Aenean at nisi urna. Proin luctus turpis vel augue convallis, ut tincidunt quam varius. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nullam ut faucibus libero, quis egestas risus.&#x0a;&#x0a;Donec et lacus vestibulum, tempor velit a, tincidunt sem. Sed egestas at ante sed rutrum. Vivamus sit amet magna quis felis malesuada tempus nec eu mi. Quisque sed enim egestas, scelerisque magna eget, ornare arcu. Ut nec semper nulla, sit amet mollis sem. In hac habitasse platea dictumst. Praesent ullamcorper eu magna quis placerat.">
            <database:DndSpell.Rulebook>
                <database:DndRulebook Name="Player's Handbook III" Abbreviation="PHB III">
                    <database:DndRulebook.DndEdition>
                        <database:DndEdition Name="CORE 3.5"/>
                    </database:DndRulebook.DndEdition>
                </database:DndRulebook>
            </database:DndSpell.Rulebook>
            <database:DndSpell.ClassSpells>
                <database:DndClassSpell Level="2">
                    <database:DndClassSpell.Class>
                        <database:DndClass Name="Bard"/>
                    </database:DndClassSpell.Class>
                </database:DndClassSpell>
                <database:DndClassSpell Level="1">
                    <database:DndClassSpell.Class>
                        <database:DndClass Name="Apostle of Mammon"/>
                    </database:DndClassSpell.Class>
                </database:DndClassSpell>
            </database:DndSpell.ClassSpells>
        </database:DndSpell>
    </Design.DataContext>

    <UserControl.Resources>
        <helpers:SpellSchoolToBrushConverter x:Key="SpellSchoolToBrushConverter"
                                             NoneBackground="{StaticResource SpellSchoolNoneBackground}"
                                             AbjurationBackground="{StaticResource SpellSchoolAbjurationBackground}"
                                             ConjurationBackground="{StaticResource SpellSchoolConjurationBackground}"
                                             DivinationBackground="{StaticResource SpellSchoolDivinationBackground}"
                                             EnchantmentBackground="{StaticResource SpellSchoolEnchantmentBackground}"
                                             EvocationBackground="{StaticResource SpellSchoolEvocationBackground}"
                                             IllusionBackground="{StaticResource SpellSchoolIllusionBackground}"
                                             NecromancyBackground="{StaticResource SpellSchoolNecromancyBackground}"
                                             TransmutationBackground="{StaticResource SpellSchoolTransmutationBackground}"
                                             UniversalBackground="{StaticResource SpellSchoolUniversalBackground}" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="MinHeight" Value="70" />
        </Style>

        <Style Selector="TextBlock">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="avalonia|CTextBlock">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="avalonia|CRun">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="Foreground" Value="Black" />
        </Style>

        <Style Selector="PathIcon">
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="Height" Value="35" />
            <Setter Property="Width" Value="35" />
            <Setter Property="VerticalAlignment" Value="Stretch" />
        </Style>
        
        <Style Selector="mdxaml|MarkdownScrollViewer Border">
            <Setter Property="MinHeight" Value="30"/>
        </Style>
        
        <Style Selector="Grid.bleedingEdge">
            <Setter Property="Background" Value="{Binding School, Converter={StaticResource SpellSchoolToBrushConverter}}"/>
        </Style>
    </UserControl.Styles>

    <Grid x:Name="MainGrid" ColumnDefinitions="Auto Auto">
        <Grid Grid.Column="0" x:Name="BleedingEdgeFront" Height="1110" Width="816" Classes.bleedingEdge="{Binding $parent[views:SpellCardRenderView].IsBleedingEdgeVisible}">
            <!-- go see the comment below -->
            <Grid Height="1038" Width="744" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border x:Name="CutAreaFront" CornerRadius="30"
                        Background="{Binding School, Converter={StaticResource SpellSchoolToBrushConverter}}">
                    <Grid Height="1038" Width="744" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Border x:Name="SafeAreaFront" Height="976" Width="679" CornerRadius="15"
                                HorizontalAlignment="Center" VerticalAlignment="Center" Background="Transparent">
                            <Grid ColumnDefinitions="* * * * * *" RowDefinitions="Auto Auto Auto Auto Auto * Auto Auto"
                                  ColumnSpacing="10" RowSpacing="10" Height="{Binding $parent[Border].Height}"
                                  Width="{Binding $parent[Border].Width}">
                                <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="6">
                                    <Grid RowDefinitions="* Auto">
                                        <TextBlock Grid.Row="0" Text="{Binding Name}" TextAlignment="Center"
                                                   FontWeight="Bold" FontSize="35" />
                                        <WrapPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock FontWeight="Bold" Text="{Binding School}" />
                                            <TextBlock FontWeight="Bold"
                                                       Text="{Binding SubSchool, StringFormat={}({0})}"
                                                       IsVisible="{Binding DisplaySubschool}" />
                                            <TextBlock FontWeight="Bold"
                                                       Text="{Binding Descriptor, StringFormat={}[{0}]}"
                                                       IsVisible="{Binding DisplayDescriptor}" />
                                        </WrapPanel>
                                    </Grid>
                                </Border>

                                <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                                    <StackPanel Orientation="Horizontal">
                                        <PathIcon Data="{StaticResource Rulebook}" />
                                        <TextBlock Text="{Binding Rulebook.Abbreviation}" />
                                        <TextBlock Text="{Binding RulebookPage, StringFormat={} p.{0}}"
                                                   IsVisible="{Binding RulebookPage, Converter={x:Static ObjectConverters.IsNotNull}}" />
                                    </StackPanel>
                                </Border>
                                <Border Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="2">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource Components}" />
                                        <TextBlock Grid.Column="1" Text="{Binding AllComponents}" />
                                    </Grid>
                                </Border>
                                <Border Grid.Row="1" Grid.Column="4" Grid.ColumnSpan="2">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource CastingTime}" />
                                        <TextBlock Grid.Column="1" Text="{Binding CastingTime}" />
                                    </Grid>
                                </Border>

                                <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource Range}" />
                                        <TextBlock Grid.Column="1" Text="{Binding RangeDisplayText}" />
                                    </Grid>
                                </Border>
                                <Border Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource Duration}" />
                                        <TextBlock Grid.Column="1" Text="{Binding Duration}" />
                                    </Grid>
                                </Border>
                                <Border Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource SavingThrow}" />
                                        <TextBlock Grid.Column="1" Text="{Binding SavingThrow}" />
                                    </Grid>
                                </Border>
                                <Border Grid.Row="4" Grid.Column="3" Grid.ColumnSpan="3">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <PathIcon Data="{StaticResource SpellResistance}" />
                                        <TextBlock Grid.Column="1" Text="{Binding SpellResistance}" />
                                    </Grid>
                                </Border>

                                <Border Grid.Row="2" Grid.Column="3" Grid.RowSpan="2" Grid.ColumnSpan="3">
                                    <Grid RowDefinitions="Auto Auto Auto">
                                        <Grid Grid.Row="0" ColumnDefinitions="Auto *" ColumnSpacing="5"
                                              IsVisible="{Binding Target, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <PathIcon Data="{StaticResource Target}" />
                                            <TextBlock Grid.Column="1" Text="{Binding Target}" />
                                        </Grid>
                                        <Grid Grid.Row="1" ColumnDefinitions="Auto *" ColumnSpacing="5"
                                              IsVisible="{Binding Area, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <PathIcon Data="{StaticResource Area}" />
                                            <TextBlock Grid.Column="1" Text="{Binding Area}" />
                                        </Grid>
                                        <Grid Grid.Row="2" ColumnDefinitions="Auto *" ColumnSpacing="5"
                                              IsVisible="{Binding Effect, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <PathIcon Data="{StaticResource Effect}" />
                                            <TextBlock Grid.Column="1" Text="{Binding Effect}" />
                                        </Grid>
                                    </Grid>
                                </Border>

                                <Border Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="6">
                                    <TextBlock Text="{Binding DescriptionShort}" VerticalAlignment="Top" />
                                </Border>

                                <StackPanel Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="6" Spacing="10">
                                    <Border IsVisible="{Binding HasMaterialComponent}">
                                        <TextBlock Text="{Binding MaterialComponent, StringFormat={}Material Component: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasArcaneFocus}">
                                        <TextBlock Text="{Binding ArcaneFocus, StringFormat={}Arcane Focus: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasExperienceComponent}">
                                        <TextBlock Text="{Binding ExperienceComponent, StringFormat={}XP Cost: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasTruenameComponent}">
                                        <TextBlock Text="{Binding TruenameComponent, StringFormat={}Truename: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasCorruptionComponent}">
                                        <TextBlock Text="{Binding CorruptionComponent, StringFormat={}Corruption: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasSacrificeComponent}">
                                        <TextBlock Text="{Binding SacrificeComponent, StringFormat={}Mindset: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasAbstinenceComponent}">
                                        <TextBlock Text="{Binding AbstinenceComponent, StringFormat={}Abstinence: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasMindsetComponent}">
                                        <TextBlock Text="{Binding MindsetComponent, StringFormat={}Mindset: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasLocationComponent}">
                                        <TextBlock Text="{Binding LocationComponent, StringFormat={}Location: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasDragonmarkComponent}">
                                        <TextBlock Text="{Binding DragonmarkComponent, StringFormat={}Dragonmark: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasDiseaseComponent}">
                                        <TextBlock Text="{Binding DiseaseComponent, StringFormat={}Disease: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding HasColdfireComponent}">
                                        <TextBlock Text="{Binding ColdfireComponent, StringFormat={}Coldfire: {0}}" />
                                    </Border>
                                    <Border IsVisible="{Binding ExtraComponent, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                        <TextBlock Text="{Binding ExtraComponent, StringFormat={}Extra: {0}}" />
                                    </Border>
                                </StackPanel>

                                <Border Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="6">
                                    <Grid ColumnDefinitions="Auto *" ColumnSpacing="5">
                                        <TextBlock Grid.Column="1" Text="{Binding ClassDisplayTextSingleLine}" FontWeight="Bold"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <Grid Grid.Column="1" x:Name="BleedingEdgeBack" Height="1110" Width="816" Classes.bleedingEdge="{Binding $parent[views:SpellCardRenderView].IsBleedingEdgeVisible}">
            <!-- Surround Border with a grid for rendering purposes, so that the border has an effective margin of 0. -->
            <!-- When in doubt, git blame and check the commit this was introduced in -->
            <Grid Height="1038" Width="744" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border x:Name="CutAreaBack" CornerRadius="30"
                        Background="{Binding School, Converter={StaticResource SpellSchoolToBrushConverter}}">
                    <Grid Height="1038" Width="744" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Border x:Name="SafeAreaBack" Height="976" Width="679" Background="Transparent"
                                CornerRadius="15"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Grid Height="{Binding $parent[Border].Height}" Width="{Binding $parent[Border].Width}">
                                <Grid RowDefinitions="* Auto" RowSpacing="10">
                                    <Border Grid.Row="0">
                                        <mdxaml:MarkdownScrollViewer Markdown="{Binding Description}"
                                                                     VerticalAlignment="Top">
                                            <mdxaml:MarkdownScrollViewer.Styles>
                                                <Style Selector="ScrollViewer">
                                                    <Setter Property="VerticalScrollBarVisibility" Value="Disabled"/>
                                                </Style>
                                            </mdxaml:MarkdownScrollViewer.Styles>
                                        </mdxaml:MarkdownScrollViewer>
                                    </Border>
                                    
                                    <Border Grid.Row="1">
                                        <StackPanel Orientation="Horizontal">
                                            <PathIcon Data="{StaticResource Rulebook}" />
                                            <TextBlock Text="{Binding Rulebook.DndEdition.Name, StringFormat={}[{0}] - }" />
                                            <TextBlock Text="{Binding Rulebook.Name}" />
                                            <TextBlock Text="{Binding RulebookPage, StringFormat={} p.{0}}"
                                                       IsVisible="{Binding RulebookPage, Converter={x:Static ObjectConverters.IsNotNull}}" />
                                            
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>